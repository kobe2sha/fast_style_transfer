利用
元のDIR　argparse
python app/neural_style/neural_style.py eval --content-image app/images/content-images/train/amber.jpg --model app/saved_models/mosaic.pth --output-image app/images/output-images/アンバー３.jpg --cuda 0
修正後 argparse使わないコマンドライン引数
python app/neural_style/neural_style.py app/images/content-images/train/amber.jpg app/saved_models/mosaic.pth app/images/output-images/アンバー6.jpg 0
python app/neural_style/neural_style.py app/images/content-images/train/wanwan.jpg


学習
python app/neural_style/neural_style.py train --dataset app/images/content-images --style-image app/images/style-images/udnie.jpg --save-model-dir app/model --batch-size 2 --epochs 1 --cuda 0

docker上でのlambda関数テスト　ファイル名に日本語使えないので注意
curl -d '{"Records": ["images/content-images/train/amber.jpg", "saved_models/mosaic.pth", "images/output-images/test.jpg", 0]}' http://localhost:9000/2015-03-31/functions/function/invocations


AWSのDOCKERにするにあたっての変更

import utils
from transformer_net import TransformerNet
from vgg import Vgg16
から
from neural_style import utils
from neural_style.transformer_net import TransformerNet
from neural_style.vgg import Vgg16

def main():
から
def handler(event, context):

以下を消した
if __name__ == "__main__":
    main()

サーバー上とローカルでDIR構成が異なる
AWSはファイル名に日本語使えないので注意
argparseはクラス化するので、それに合わせて入力変更する sys.argv使う。リストになるのでそこからクラスにする
関数への入力にアンパックつかう
入力が数字でなく文字列になってしまうことあるので、型指定する

1/12 S3用の修正

{"Records":
  ["images/content-images/train/amber.jpg", "saved_models/mosaic.pth", "images/output-images/test.jpg", 0]}

以下の様に修正される
  {"Params":
      ["saved_models/candy.pth", "images/output-images/test2.jpg", 0],
  "Records":
  [{"s3": {"bucket": {"name": "mybucket-test994"}, "object": {"key": "downloada.png"}}}]
  }

S3の認証情報を付加してRUNするのは以下のコード
docker run --rm -p 9000:8080 -e AWS_ACCESS_KEY_ID=AKIAYZUK3X7VWGS6VAC2 -e AWS_SECRET_ACCESS_KEY=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 -e AWS_DEFAULT_REGION=ap-northeast-1 neural_doc

curlでは以下のように送る
curl -d '{"Params": ["saved_models/candy.pth", "images/output-images/test2.jpg", 0], "Records": {"s3": {"bucket": {"name": "mybucket-test994"}, "object": {"key": "downloada.png"}}}}' http://localhost:9000/2015-03-31/functions/function/invocations
S3使ってアップ、ダウンロードする場合はこちら
curl -d '{"Records": [{"s3": {"bucket": {"name": "mybucket-test994"}, "object": {"key": "69ACA424-10D4-4876-9CDB-BD8D332A3DB6.jpg"}}}]}' http://localhost:9000/2015-03-31/functions/function/invocations
